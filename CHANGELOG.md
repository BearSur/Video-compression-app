# 项目更新日志 (详细版)

本文档详细记录了本项目从初始原型到当前稳定版的完整迭代历史，包括功能开发、问题修复、以及为了解决特定问题而进行的探索性尝试。

---

### 版本 7.0: 分享功能优化

- **核心优化**: 为了解决在分享时，分享列表中不出现微信、QQ等常用应用的问题，重构了分享功能的底层逻辑。
- **实现方式**: 改变了之前直接使用 `FileProvider` 分享应用私有文件的做法。新逻辑会先将待分享的视频文件保存到系统的公共媒体库（相册），然后使用这个对所有应用都可见的公共 URI 来发起分享。此举彻底解决了目标应用因权限不足而无法接收分享的问题。

---

### 版本 6.0: 移除替换功能并增强分享

- **核心决策**: 在多次尝试修复“替换”功能的闪退问题失败后，为保证应用的稳定性，决定彻底移除该功能。
- **界面与代码清理**:
  - 从 `activity_main.xml` 布局文件中移除了“替换”按钮。
  - 从 `MainActivity.kt` 中删除了所有与替换、删除原始文件相关的代码逻辑，包括 `replaceVideo`, `deleteOriginalVideos`, `showReplaceConfirmationDialog` 以及批量替换的选项。
- **功能增强**: 扩展了分享功能，使其能够支持一次性分享多个视频文件。

---

### 版本 5.0 (探索性修复): “替换”功能闪退问题二次修复尝试

- **问题背景**: “替换”功能在 4.0 版本的修复后，在特定安卓版本（尤其是安卓 10）上依然会导致闪退。
- **修复方案**: 
  - 针对安卓 10 (API 29) 增加了特定的 `RecoverableSecurityException` 异常捕获逻辑，当删除文件失败时，尝试引导用户手动授权。
  - 为避免糟糕的用户体验，限制了“批量替换”功能仅在能够发起统一删除请求的安卓 11 (API 30) 及以上版本中显示。
- **迭代结果**: **失败**。此方案在实践中依然存在兼容性问题和不稳定的情况，未能完全解决闪退，最终促成了在 6.0 版本中移除该功能的决定。

---

### 版本 4.0: 保存到相册与“替换”闪退初步修复

- **新功能**: 实现了 `saveVideoToGallery` 方法，将压缩后的视频通过 `MediaStore` API 保存到系统的公共相册中，解决了用户在相册中看不到已保存视频的问题。
- **问题修复**: 针对用户报告的点击“替换”按钮时应用闪退的问题进行了初步修复。分析原因是直接删除用户选择的媒体文件导致 `SecurityException`。
- **修复方案**: 尝试使用 `MediaStore.createDeleteRequest` (适用于安卓 11+) 和更通用的异常捕获来处理删除操作，以避免应用崩溃。
- **迭代结果**: **部分成功**。保存功能成功实现，但替换功能的闪退问题未被完全解决，在某些安卓版本上依然存在。

---

### 版本 3.0: 批量处理功能实现

- **核心功能**: 在 2.0 版本的基础上，进一步实现了完整的批量处理能力。
- **实现方式**:
  - **多文件选择**: 更新文件选择逻辑，允许用户在文件选择器中一次性选择多个视频文件。
  - **压缩队列**: 修改压缩流程，使其能够接收一个视频 URI 列表，并按顺序逐个压缩。
  - **进度反馈**: 优化了进度条和文本提示，使其能够显示“正在压缩第 X 个，共 Y 个”的总体进度。

---

### 版本 2.0: 权限适配与界面汉化

- **核心功能**: 完成了项目的基础改造，解决了最紧迫的两个问题。
- **权限适配**: 
  - 弃用了已过时的 `WRITE_EXTERNAL_STORAGE` 权限和 `requestLegacyExternalStorage` 属性。
  - 根据安卓系统版本动态请求权限：为安卓 13 (API 33) 及以上系统请求 `READ_MEDIA_VIDEO` 权限，为老版本系统则保留 `READ_EXTERNAL_STORAGE` 权限。
- **界面汉化**: 
  - 将应用内所有用户可见的文本（按钮、标签、提示）翻译为中文。
  - 所有硬编码的英文字符串均被替换为对 `strings.xml` 中文资源文件的引用。

---

### 版本 1.0: 项目初始状态

- **基本功能**: 应用具备选择单个视频、进行压缩以及播放预览的核心功能。
- **存在问题**:
  1.  在较新的安卓系统上存在权限申请异常和功能失效的问题。
  2.  用户界面和所有提示信息均为英文。
  3.  不支持批量处理视频。
